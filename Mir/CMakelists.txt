cmake_minimum_required(VERSION 3.28)
project(Mir LANGUAGES CXX)

# Set the C++ standard to C++17
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED True)
set(CMAKE_CXX_EXTENSIONS OFF)

# Set the output directory for binaries
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin)

# Ensure the output directory exists
file(MAKE_DIRECTORY ${CMAKE_RUNTIME_OUTPUT_DIRECTORY})

# Fetch dependencies
include(FetchContent)

# Fetch spdlog
FetchContent_Declare(
  spdlog
  GIT_REPOSITORY https://github.com/gabime/spdlog.git
  GIT_TAG v1.9.2
)
FetchContent_MakeAvailable(spdlog)

# Fetch ImGui
FetchContent_Declare(
  imgui
  GIT_REPOSITORY https://github.com/ocornut/imgui.git
  GIT_TAG docking
)
FetchContent_MakeAvailable(imgui)

# Fetch SDL2
FetchContent_Declare(
  sdl2
  GIT_REPOSITORY https://github.com/libsdl-org/SDL.git
  GIT_TAG release-2.26.0
)
FetchContent_MakeAvailable(sdl2)

# Include directories
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/include)
include_directories(${CMAKE_BINARY_DIR}/_deps/imgui-src)
include_directories(${CMAKE_BINARY_DIR}/_deps/imgui-src/backends)
include_directories(${CMAKE_BINARY_DIR}/_deps/sdl2-src/include)

# Create a static library for ImGui
add_library(imgui STATIC
  ${CMAKE_BINARY_DIR}/_deps/imgui-src/imgui.cpp
  ${CMAKE_BINARY_DIR}/_deps/imgui-src/imgui_draw.cpp
  ${CMAKE_BINARY_DIR}/_deps/imgui-src/imgui_tables.cpp
  ${CMAKE_BINARY_DIR}/_deps/imgui-src/imgui_widgets.cpp
  ${CMAKE_BINARY_DIR}/_deps/imgui-src/imgui_demo.cpp
  ${CMAKE_BINARY_DIR}/_deps/imgui-src/backends/imgui_impl_sdl2.cpp
  ${CMAKE_BINARY_DIR}/_deps/imgui-src/backends/imgui_impl_opengl3.cpp
)

# Add the engine library (DLL)
add_library(Mir SHARED
  src/application.cpp
)

# Define macros
target_compile_definitions(Mir PRIVATE MIR_PLATFORM_WINDOWS MIR_BUILD_DLL)

target_compile_definitions(Mir PRIVATE BUILD_DLL)
find_package(OpenGL REQUIRED)
target_link_libraries(Mir PRIVATE spdlog::spdlog SDL2::SDL2 SDL2::SDL2main OpenGL::GL imgui)
target_include_directories(Mir PRIVATE ${CMAKE_BINARY_DIR}/_deps/imgui-src ${CMAKE_BINARY_DIR}/_deps/imgui-src/backends ${CMAKE_BINARY_DIR}/_deps/sdl2-src/include)



# Custom command to copy resources folder
add_custom_command(TARGET Mir POST_BUILD
  COMMAND ${CMAKE_COMMAND} -E copy_directory
  ${CMAKE_CURRENT_SOURCE_DIR}/resources $<TARGET_FILE_DIR:Mir>/resources
)

# Custom target to trigger the command
add_custom_target(copy_resources ALL DEPENDS Mir)